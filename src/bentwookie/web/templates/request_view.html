{% extends "base.html" %}
{% block title_suffix %} - {{ req.reqname }}{% endblock %}

{% block content %}
<div class="page-header">
    <h1>{{ req.reqname }}</h1>
    <div class="button-group">
        <form action="{{ url_for('request_delete_route', reqid=req.reqid) }}" method="POST" style="display:inline;"
              onsubmit="return confirm('Delete request {{ req.reqname }}?');">
            <button type="submit" class="btn btn-danger">Delete</button>
        </form>
    </div>
</div>

<div class="detail-card">
    <dl class="detail-list">
        <dt>ID</dt>
        <dd>{{ req.reqid }}</dd>

        <dt>Project</dt>
        <dd><a href="{{ url_for('project_view', prjid=project.prjid) }}">{{ project.prjname }}</a></dd>

        <dt>Type</dt>
        <dd>{{ TYPE_NAMES.get(req.reqtype, req.reqtype) }}</dd>

        <dt>Phase</dt>
        <dd><span class="badge badge-phase badge-lg">{{ PHASE_NAMES.get(req.reqphase, req.reqphase) }}</span></dd>

        <dt>Status</dt>
        <dd><span class="badge badge-{{ req.reqstatus }} badge-lg">{{ STATUS_NAMES.get(req.reqstatus, req.reqstatus) }}</span></dd>

        <dt>Priority</dt>
        <dd>{{ req.reqpriority }}</dd>

        <dt>Code Directory</dt>
        <dd>{{ req.reqcodedir or '-' }}</dd>

        <dt>Documentation</dt>
        <dd>{{ req.reqdocpath or '-' }}</dd>

        <dt>Last Updated</dt>
        <dd>{{ req.reqtouchts }}</dd>
    </dl>
</div>

<section class="section">
    <h2>Prompt</h2>
    <div class="prompt-box">
        <pre>{{ req.reqprompt }}</pre>
    </div>
</section>

<section class="section">
    <h2>Update Status/Phase</h2>
    <form action="{{ url_for('request_update_route', reqid=req.reqid) }}" method="POST" class="form inline-form">
        <div class="form-group">
            <label for="status">Status</label>
            <select id="status" name="status">
                <option value="">-- No change --</option>
                {% for s in VALID_STATUSES %}
                <option value="{{ s }}" {% if req.reqstatus == s %}selected{% endif %}>{{ STATUS_NAMES.get(s, s) }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="form-group">
            <label for="phase">Phase</label>
            <select id="phase" name="phase">
                <option value="">-- No change --</option>
                {% for p in PHASES[:-1] %}
                <option value="{{ p }}" {% if req.reqphase == p %}selected{% endif %}>{{ PHASE_NAMES.get(p, p) }}</option>
                {% endfor %}
            </select>
        </div>

        <button type="submit" class="btn btn-primary">Update</button>
    </form>
</section>
{% endblock %}
