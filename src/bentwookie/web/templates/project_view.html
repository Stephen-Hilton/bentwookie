{% extends "base.html" %}
{% block title_suffix %} - {{ project.prjname }}{% endblock %}

{% block content %}
<div class="page-header">
    <h1>{{ project.prjname }}</h1>
    <div class="button-group">
        <a href="{{ url_for('request_new') }}?project={{ project.prjid }}" class="btn btn-primary">New Request</a>
        <form action="{{ url_for('project_delete_route', prjid=project.prjid) }}" method="POST" style="display:inline;"
              onsubmit="return confirm('Delete project {{ project.prjname }}?');">
            <button type="submit" class="btn btn-danger">Delete Project</button>
        </form>
    </div>
</div>

<div class="detail-card">
    <dl class="detail-list">
        <dt>ID</dt>
        <dd>{{ project.prjid }}</dd>

        <dt>Version</dt>
        <dd>{{ project.prjversion }}</dd>

        <dt>Priority</dt>
        <dd>{{ project.prjpriority }}</dd>

        <dt>Phase</dt>
        <dd>{{ project.prjphase }}</dd>

        <dt>Description</dt>
        <dd>{{ project.prjdesc or '-' }}</dd>

        <dt>Last Updated</dt>
        <dd>{{ project.prjtouchts }}</dd>
    </dl>
</div>

<section class="section">
    <h2>Requests ({{ requests|length }})</h2>

    {% if requests %}
    <table class="table">
        <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Type</th>
                <th>Phase</th>
                <th>Status</th>
                <th>Priority</th>
            </tr>
        </thead>
        <tbody>
            {% for r in requests %}
            <tr>
                <td><a href="{{ url_for('request_view', reqid=r.reqid) }}">{{ r.reqid }}</a></td>
                <td>{{ r.reqname }}</td>
                <td>{{ TYPE_NAMES.get(r.reqtype, r.reqtype) }}</td>
                <td><span class="badge badge-phase">{{ PHASE_NAMES.get(r.reqphase, r.reqphase) }}</span></td>
                <td><span class="badge badge-{{ r.reqstatus }}">{{ STATUS_NAMES.get(r.reqstatus, r.reqstatus) }}</span></td>
                <td>{{ r.reqpriority }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p class="empty-state">No requests yet. <a href="{{ url_for('request_new') }}?project={{ project.prjid }}">Create one</a></p>
    {% endif %}
</section>
{% endblock %}
